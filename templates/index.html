<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SociaFam - Connect with Friends and Family</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login/Register Modal -->
    <div id="auth-modal" class="modal" style="{{ 'display:none;' if current_user.is_authenticated else '' }}">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="auth-tabs">
                <button class="tab-button active" data-tab="login">Login</button>
                <button class="tab-button" data-tab="register">Register</button>
            </div>
            
            <div id="login-tab" class="tab-content active">
                <h2>Welcome Back to SociaFam</h2>
                <form method="POST" action="{{ url_for('login') }}">
                    <div class="form-group">
                        <input type="text" name="username" placeholder="Username" required>
                    </div>
                    <div class="form-group">
                        <input type="password" name="password" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn-primary">Log In</button>
                </form>
            </div>
            
            <div id="register-tab" class="tab-content">
                <h2>Join SociaFam Today</h2>
                <form method="POST" action="{{ url_for('register') }}">
                    <div class="form-group">
                        <input type="text" name="username" placeholder="Username" required>
                    </div>
                    <div class="form-group">
                        <input type="email" name="email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" name="password" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn-primary">Sign Up</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" style="{{ 'display:none;' if not current_user.is_authenticated else '' }}">
        <!-- Header/Navigation -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1><i class="fas fa-users"></i> SociaFam</h1>
                </div>
                
                <div class="search-bar">
                    <input type="text" placeholder="Search for people, posts, or groups...">
                    <button><i class="fas fa-search"></i></button>
                </div>
                
                <nav class="nav-menu">
                    <a href="{{ url_for('feed') }}" class="nav-item active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-user-friends"></i>
                        <span>Friends</span>
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-video"></i>
                        <span>Watch</span>
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-store"></i>
                        <span>Marketplace</span>
                    </a>
                </nav>
                
                <div class="user-menu">
                    <div class="user-info">
                        <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) if current_user.is_authenticated and current_user.profile_pic else 'https://via.placeholder.com/40/1a3a2a/ffffff?text=SF' }}" alt="Profile" class="profile-pic-small">
                        <span>{{ current_user.username if current_user.is_authenticated else '' }}</span>
                    </div>
                    <div class="quick-actions">
                        <button class="icon-btn"><i class="fas fa-plus"></i></button>
                        <button class="icon-btn"><i class="fas fa-comment-dots"></i></button>
                        <button class="icon-btn"><i class="fas fa-bell"></i></button>
                    </div>
                    <div class="dropdown">
                        <button class="dropdown-btn"><i class="fas fa-caret-down"></i></button>
                        <div class="dropdown-content">
                            <a href="/profile/{{ current_user.id if current_user.is_authenticated else '' }}"><i class="fas fa-user"></i> Profile</a>
                            <a href="#"><i class="fas fa-cog"></i> Settings</a>
                            <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar left-sidebar">
                <div class="user-card">
                    <div class="cover-photo">
                        <img src="{{ url_for('static', filename='uploads/' + current_user.cover_photo) if current_user.is_authenticated and current_user.cover_photo else 'https://via.placeholder.com/800x200/1a3a2a/ffffff?text=SociaFam+Cover' }}" alt="Cover">
                    </div>
                    <div class="user-details">
                        <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) if current_user.is_authenticated and current_user.profile_pic else 'https://via.placeholder.com/150/1a3a2a/ffffff?text=SF' }}" alt="Profile" class="profile-pic-large">
                        <h3>{{ current_user.username if current_user.is_authenticated else '' }}</h3>
                        <p>{{ current_user.bio if current_user.is_authenticated and current_user.bio else 'No bio yet' }}</p>
                    </div>
                </div>
                
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-user-friends"></i>
                        <span>Friends</span>
                    </a>
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-users"></i>
                        <span>Groups</span>
                        <span class="badge">5</span>
                    </a>
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Events</span>
                    </a>
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-bookmark"></i>
                        <span>Saved</span>
                    </a>
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-clock"></i>
                        <span>Memories</span>
                    </a>
                    <a href="#" class="sidebar-item">
                        <i class="fas fa-flag"></i>
                        <span>Pages</span>
                    </a>
                </nav>
                
                <div class="shortcuts">
                    <h3>Your Shortcuts</h3>
                    <a href="#" class="shortcut-item">
                        <i class="fas fa-gamepad"></i>
                        <span>Gaming</span>
                    </a>
                    <a href="#" class="shortcut-item">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Courses</span>
                    </a>
                    <a href="#" class="shortcut-item">
                        <i class="fas fa-heart"></i>
                        <span>Dating</span>
                    </a>
                </div>
            </aside>

            <!-- Center Feed -->
            <section class="feed">
                <!-- Create Post Card -->
                <div class="card create-post">
                    <div class="post-header">
                        <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) if current_user.is_authenticated and current_user.profile_pic else 'https://via.placeholder.com/40/1a3a2a/ffffff?text=SF' }}" alt="Profile" class="profile-pic-small">
                        <input type="text" placeholder="What's on your mind, {{ current_user.username if current_user.is_authenticated else 'User' }}?">
                    </div>
                    <div class="post-actions">
                        <button class="post-action-btn">
                            <i class="fas fa-video" style="color: #f02849;"></i>
                            <span>Live Video</span>
                        </button>
                        <button class="post-action-btn">
                            <i class="fas fa-images" style="color: #45bd62;"></i>
                            <span>Photo/Video</span>
                        </button>
                        <button class="post-action-btn">
                            <i class="fas fa-laugh-beam" style="color: #f7b928;"></i>
                            <span>Feeling/Activity</span>
                        </button>
                    </div>
                </div>

                <!-- Stories -->
                <div class="stories-container">
                    <div class="story-card create-story">
                        <div class="story-content">
                            <div class="story-avatar">
                                <img src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) if current_user.is_authenticated and current_user.profile_pic else 'https://via.placeholder.com/50/1a3a2a/ffffff?text=SF' }}" alt="Profile">
                                <div class="add-story-btn">+</div>
                            </div>
                            <p>Create Story</p>
                        </div>
                    </div>
                    
                    <!-- Story cards will be populated by JavaScript -->
                </div>

                <!-- Posts Feed -->
                <div id="posts-container">
                    {% if posts %}
                        {% for post in posts %}
                        <div class="card post">
                            <div class="post-user">
                                <img src="{{ url_for('static', filename='uploads/' + post.author.profile_pic) if post.author.profile_pic else 'https://via.placeholder.com/40/1a3a2a/ffffff?text=SF' }}" alt="{{ post.author.username }}" class="profile-pic-small">
                                <div class="post-user-info">
                                    <h4>{{ post.author.username }}</h4>
                                    <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                                </div>
                            </div>
                            <div class="post-content">
                                <p>{{ post.content }}</p>
                                {% if post.image %}
                                    <img src="{{ url_for('static', filename='uploads/' + post.image) }}" alt="Post image" class="post-image">
                                {% endif %}
                            </div>
                            <div class="post-stats">
                                <div class="likes-count">
                                    <span>{{ post.likes|length }} likes</span>
                                </div>
                                <div class="comments-count">
                                    <span>{{ post.comments|length }} comments</span>
                                </div>
                            </div>
                            <div class="post-actions-row">
                                <div class="reactions-container">
                                    <button class="post-action like-btn" data-post-id="{{ post.id }}">
                                        <i class="fas fa-thumbs-up"></i>
                                        <span>Like</span>
                                    </button>
                                    <div class="reactions-tooltip">
                                        <span data-reaction="like">👍</span>
                                        <span data-reaction="love">❤️</span>
                                        <span data-reaction="haha">😄</span>
                                        <span data-reaction="wow">😲</span>
                                        <span data-reaction="sad">😢</span>
                                        <span data-reaction="angry">😠</span>
                                    </div>
                                </div>
                                <button class="post-action comment-btn" data-post-id="{{ post.id }}">
                                    <i class="fas fa-comment"></i>
                                    <span>Comment</span>
                                </button>
                                <button class="post-action share-btn" data-post-id="{{ post.id }}">
                                    <i class="fas fa-share"></i>
                                    <span>Share</span>
                                </button>
                            </div>
                            <div class="comments-section" id="comments-{{ post.id }}" style="display: none;">
                                <div class="comments-list">
                                    {% for comment in post.comments %}
                                    <div class="comment">
                                        <img src="{{ url_for('static', filename='uploads/' + comment.author.profile_pic) if comment.author.profile_pic else 'https://via.placeholder.com/32/1a3a2a/ffffff?text=SF' }}" alt="User" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-author">{{ comment.author.username }}</span>
                                                <span class="comment-time">{{ comment.created_at.strftime('%H:%M') }}</span>
                                            </div>
                                            <p>{{ comment.content }}</p>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="add-comment">
                                    <input type="text" placeholder="Write a comment..." class="comment-input">
                                    <button class="comment-submit-btn" data-post-id="{{ post.id }}">Post</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="card">
                            <div style="padding: 40px; text-align: center;">
                                <h3>Welcome to SociaFam!</h3>
                                <p>Start connecting with friends by creating your first post or adding friends.</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <div class="load-more-container">
                    <button id="load-more-btn" class="btn-secondary">Load More Posts</button>
                </div>
            </section>

            <!-- Right Sidebar -->
            <aside class="sidebar right-sidebar">
                <div class="contacts-section">
                    <h3>Contacts</h3>
                    <div class="contacts-list">
                        <!-- Contacts will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="suggestions-section">
                    <h3>Suggestions for You</h3>
                    <div class="suggestions-list">
                        <!-- Suggestions will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="birthdays-section">
                    <h3>Birthdays</h3>
                    <div class="birthday-item">
                        <i class="fas fa-birthday-cake"></i>
                        <span>No birthdays today.</span>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Chat Widget -->
        <div class="chat-widget">
            <div class="chat-header">
                <h3>Chats</h3>
                <div class="chat-actions">
                    <button class="icon-btn"><i class="fas fa-video"></i></button>
                    <button class="icon-btn"><i class="fas fa-edit"></i></button>
                </div>
            </div>
            <div class="chats-list">
                <!-- Chats will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-messages">
                {% for message in messages %}
                    <div class="flash-message">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
